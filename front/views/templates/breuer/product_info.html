<!--INFOS PRODUCTS-->
<div id="infosProd">
    <strong id="breuer">Breuer</strong>
    <h1>${product_info.get('name')}</h1>
    <span class="descrpt">${product_info.get('desc')}</span>
    <?py display=product_info.get('display',{}) ?>
    <span id="discounted_price" class="prix1">${display.get('price')} ${product_info.get('price',{}).get('@currency')}</span>

    <?py if product_info.get('discount'): ?>
    <em class="prix2">au lieu de <span id="ori_price">${display.get('ori_price')} ${product_info.get('price', {}).get('@currency')}</span></em>
    <?py #endif ?>
    <p>
    </p>

    <form id="addForm" method="post" action="${basket_url_format}">
        <input type="hidden" name="cmd" value="add" />
        <input type="hidden" name="id_sale" value="${product_info['@id']}" />

        <?py if product_info.get('variant'): ?>
        <strong class="coloris">Coloris</strong>
        <ul id="selectColoris">
            <?py variants = product_info.get('variant',{})?>
            <?py variants = variants if isinstance(variants, list) else [variants] ?>
            <?py for variant in variants: ?>
            <li value="${variant.get('@id')}"><a href="javascript:void(0)" src="${variant.get('img') or get_single_attribute(product_info, 'img')}"><img src="${variant.get('thumb')}" alt="${variant.get('@id')}" /></a></li>
            <?py #endfor ?>
        </ul>
        <input type="hidden" name="id_variant" value="" />
        <?py #endif ?>

        <?py if product_info.get('type',{}).get('attribute',{}): ?>
        <a id="guideBtn" href="#">Guide des tailles</a>

        <div id="selectTaille">
            <select name="id_attr" id="type_attribute_selector">
                <option value="">Selectionner la taille</option>
                <?py attributes = product_info.get('type',{}).get('attribute',{}) ?>
                <?py attributes = attributes if isinstance(attributes, list) else [attributes] ?>
                <?py for type_attr in attributes: ?>
                <option value="${type_attr.get('@id')}">${type_attr.get('name')}</option>
                <?py #endfor ?>
            </select>
        </div>
        <?py #endif ?>

        <?py if product_info.get('shop',{}): ?>
        <div id="selectShop">
            <select name="id_shop">
                <?py shops = product_info.get('shop',{}) ?>
                <?py shops = shops if isinstance(shops, list) else [shops] ?>
                <?py for shop in shops: ?>
                <option value="${shop.get('@id')}">${shop.get('name')}</option>
                <?py #endfor ?>
            </select>
        </div>
        <?py #endif ?>

        <a href="javascript:addToBasket()" id="btnBuy">Ajouter au panier</a>

    </form>
</div>

<!--//INFOS PRODUCTS-->


<!--VISUEL PRODUCT-->
<div id="visuelProd">
    <div class="main-image">
        <div class="easyzoom easyzoom--overlay">
            <a href="${get_single_attribute(product_info, 'img')}" >
                <img src="${get_single_attribute(product_info, 'img')}" alt="" width="523" height="523" class="custom" />
            </a>
        </div>
    </div>

<?py if isinstance(product_info.get('img'),list): ?>
    <ul class="thumbnails">
        <?py for img in product_info.get('img'): ?>
        <li><a href="${img}"><img src="${img}" alt="product_info.get('name')" /></a></li>
        </li>
        <?py #endfor ?>
    </ul>
<?py #endif ?>
</div>
<!--//VISUEL PRODUCT-->


</div>
<!--//MAIN PRODUCT-->


<div class="listProd listFiche">
<strong class="discover"><span>&Agrave; découvrir également</span></strong>

<?py for p in product_list[:5]: ?>
    <?py include('_product_list_item.html', p=p) ?>
<?py #endfor ?>
</div>

<script type="text/javascript">
    $("#type_attribute_selector").val("");
$(function(){
    $("#selectColoris li").click(function(){
        $(this).attr('class', 'selected').siblings().attr('class', '');
    });

    $("#selectColoris li a").click(function(){
        var img = $(this).attr('src');
        api.$link.attr("href", img);
        api.$image.attr("src", img);
        if (api.$zoom) {
            api.$zoom.remove();
            api.isReady = false;
        }
    });

    $("#visuelProd .thumbnails li a").click(function(){
        var img = $(this).attr('href');
        api.$link.attr("href", img);
        if (api.$zoom) {
            api.$zoom.remove();
            api.isReady = false;
        }
    });

    <?py if product_info.get('type',{}).get('attribute',{}): ?>
    $("#type_attribute_selector").change(function(){
        var type_attr_id = $(this).val();
        var ori_price = null;
        var cur = null;

        <?py for attr in attributes: ?>
        if (type_attr_id.toString() == "${attr.get('@id')}") {
            <?py if 'price' not in attr: ?>
                return
            <?py else: ?>
                ori_price = #{attr.get('price', {}).get('#text', 999999)};
                ori_price = parseFloat(ori_price).toFixed(2);
                cur = "#{attr.get('price', {}).get('@currency', '')}";
            <?py #endif ?>
        }
        <?py #endfor ?>

        if (ori_price && cur) {
            $("#ori_price").text(ori_price + " " + cur);
            <?py if product_info.get('discount'): ?>
                var discounted_price;
                <?py if display.get('discount_type', '') == 'fixed': ?>
                    discounted_price = (ori_price - parseFloat(${display.get('discount')})).toFixed(2);
                <?py elif display.get('discount_type', '') == 'ratio': ?>
                    discounted_price = (ori_price * (100 - parseFloat(${display.get('discount')})) / 100).toFixed(2);
                <?py #endif ?>
                if (discounted_price) $("#discounted_price").text(discounted_price + " " + cur);
            <?py #endif ?>
        }
    });
    <?py #endif ?>
});

function addToBasket() {
    var form = $("#addForm");

    if ($("#selectColoris li").length > 0) {
        var id_variant = $("#selectColoris li[class=selected]");
        if ($("#selectColoris li[class=selected]").length == 0) {
            alert("Please choose coloris.");
            return;
        }
        form[0].id_variant.value = id_variant.attr('value');
    }

    if ($('#selectTaille').length > 0 && form[0].id_attr.value == "") {
        alert("Please choose taille.");
        return;
    }
    form.submit();
}
</script>
