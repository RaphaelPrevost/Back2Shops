{% extends "base.html" %}
{% load i18n %}
{% load l10n %}
{% load thumbnail %}

{% block title %}{{ page_title }}{% endblock %}

{% block head %}
    <link type="text/css" rel="stylesheet" media="screen" href="{{ STATIC_URL }}css/saling.css" />
{% endblock %}

{% block navigation %}
{% include "_quick_nav.html" %}
{% endblock %}

{% block content %}
<!--Lien Haut de Page -->
<a id="lienUP" href="#conteneur">{% trans "Page Top" %}</a>

<!--content-left-->
<div id="content_Left">

    <!--Title-->
    <div id="title">
        <span>{{ page_title }}</span>
        <h2>{{ page_title }}</h2>
    </div>

    <!--FORM-->
    <form id="main_form" method="post">
    {% csrf_token %}
        <fieldset>
            <!--SELECT TRIER PAR-->
            <p id="triVente">
                <label for="trie01">{% trans "Sort by:" %}</label>
                {{ form.order_by1 }}
                <span>+</span>
                {{ form.order_by2 }}
                <input type="submit" value="{% trans "Sort" %}" />
            </p>
            <!--FIN SELECT TRIER PAR-->

            <!--VENTE-->
            {% for sale in sales %}
            <div class="vente" sale="{{ sale.id }}">
                <!--NOM, CATEGORIE, TYPE de Prod-->
                <a href="{% url edit_sale sale_id=sale.pk step="shop" %}"><h3>{{ sale.product.name }}</h3></a>
                <h4>
                    <a class="delete" href="#">[X]</a>
                    {{ sale.product.category.name }} > {{ sale.product.type.name }}
                </h4>
                <!--INFOS VENTE-->
                <div class="content">
                    <a class="imgProd" href="#">
                        {% thumbnail sale.product.pictures.all.0.picture "40x43" as im %}
                            <img style='margin:{{ im|margin:"40x43" }}' src="{{ im.url }}" alt='{% trans "Product picture" %} {{ sale.product.name }}' width="{{ im.x }}" height="{{ im.y }}"/>
                        {% endthumbnail %}
                    </a>
                    <div class="date_etat">
                        <em>{% trans "From" %} {{ sale.product.valid_from|date:"DATE_FORMAT" }} {% trans "To" %} {{ sale.product.valid_to|date:"DATE_FORMAT" }}</em>
                        <span>{% trans "Available Qty:" %} <strong>{{ sale.total_rest_stock }}</strong> | {% trans "Sales:" %} <strong>{% trans "N/A" %}</strong> | {% trans "Initial Stock:" %} <strong>{{ sale.total_stock }}</strong></span>
                    </div>
                    <div class="prix">
                        <span>{% trans "Discounted price:" %}<strong>{{ sale.product.discount_price|floatformat }}&euro;</strong></span>
                        <span>{% trans "Discount:" %} <strong>{{ sale.product.discount|floatformat }}{% if sale.product.discount_type == "percentage" %}%{% else %}&euro;{% endif %}</strong></span>
                        <span>{% trans "Item price:" %} <em>{{ sale.product.normal_price|floatformat }}&euro;</em></span>
                    </div>
                </div>
                <div class="clear"></div>
                <!--Liens DETAIL-->
                {% if sale.type_stock == "L" %}
                <a href="{% url sale_details_shop sale.pk %}" class="seeDetail seeShop">{% trans "Details per shop" %}</a>
                {% endif %}
                <a href="{% url sale_details sale.pk %}" class="seeDetail seeMain">{% trans "Details" %}</a>
            </div>
            {% endfor %}
            <!--FIN VENTE-->
        </fieldset>
    </form>
</div>

<div id="content_Right">
    <div id="controls"></div>
    <div id="detail"></div>
</div>
<!--FIN content-right-->
<div class="clear"></div>

{% endblock %}

{% block javascript %}
<script type="text/javascript">
    $(function() {
        $(".seeDetail").click(function(){
            $("#content_Right #controls").html("");
            $("#content_Right #detail").html("");
        });
        $(".seeMain").click(function(){
            $("#content_Right #detail").html('{% trans "Loading..." %}');
            $("#content_Right #detail").load($(this)[0].href);
            return false;
        });
        $(".seeShop").click(function(){
            $("#content_Right #controls").html('{% trans "Loading..." %}');
            $("#content_Right #controls").load($(this)[0].href);
            return false;
        });
        $("#content_Right #controls #shop").live('change', function(){
            if ($(this).val() == 0) {
                $("#content_Right #detail").html("");
            } else {
                $("#content_Right #detail").html('{% trans "Loading..." %}');
                $("#content_Right #detail").load($(this).val());
            }
        });
        
        $('a.delete').click(function() {
            var $this = $(this);
            if (confirm('{% trans "Are you sure you want to delete this sale?" %}')) {
                var sid = $this.parent().parent().attr('sale');
                $.post('/sales/delete/' + sid, function(response) {
                    if (response.success)
                        $this.parent().parent().fadeOut();
                }, "json");
            }
        });
    });
</script>
{% endblock %}
